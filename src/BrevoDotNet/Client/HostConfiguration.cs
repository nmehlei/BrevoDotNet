/*
 * SendinBlue API
 *
 * SendinBlue provide a RESTFul API that can be used with any languages. With this API, you will be able to :   - Manage your campaigns and get the statistics   - Manage your contacts   - Send transactional Emails and SMS   - and much more...  You can download our wrappers at https://github.com/orgs/sendinblue  **Possible responses**   | Code | Message |   | :- -- -- -- -- -- --: | - -- -- -- -- -- -- |   | 200  | OK. Successful Request  |   | 201  | OK. Successful Creation |   | 202  | OK. Request accepted |   | 204  | OK. Successful Update/Deletion  |   | 400  | Error. Bad Request  |   | 401  | Error. Authentication Needed  |   | 402  | Error. Not enough credit, plan upgrade needed  |   | 403  | Error. Permission denied  |   | 404  | Error. Object does not exist |   | 405  | Error. Method not allowed  |   | 406  | Error. Not Acceptable  | 
 *
 * The version of the OpenAPI document: 3.0.0
 * Contact: contact@sendinblue.com
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

#nullable enable

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.Json;
using System.Text.Json.Serialization;
using System.Net.Http;
using Microsoft.Extensions.DependencyInjection;
using BrevoDotNet.Api;
using BrevoDotNet.Model;

namespace BrevoDotNet.Client
{
    /// <summary>
    /// Provides hosting configuration for BrevoDotNet
    /// </summary>
    public class HostConfiguration
    {
        private readonly IServiceCollection _services;
        private readonly JsonSerializerOptions _jsonOptions = new JsonSerializerOptions();

        internal bool HttpClientsAdded { get; private set; }

        /// <summary>
        /// Instantiates the class 
        /// </summary>
        /// <param name="services"></param>
        public HostConfiguration(IServiceCollection services)
        {
            _services = services;
            _jsonOptions.Converters.Add(new JsonStringEnumConverter());
            _jsonOptions.Converters.Add(new DateTimeJsonConverter());
            _jsonOptions.Converters.Add(new DateTimeNullableJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyJsonConverter());
            _jsonOptions.Converters.Add(new DateOnlyNullableJsonConverter());
            _jsonOptions.Converters.Add(new AbTestCampaignResultJsonConverter());
            _jsonOptions.Converters.Add(new AbTestCampaignResultClickedLinksJsonConverter());
            _jsonOptions.Converters.Add(new AbTestCampaignResultStatisticsJsonConverter());
            _jsonOptions.Converters.Add(new AbTestVersionClicksInnerJsonConverter());
            _jsonOptions.Converters.Add(new AbTestVersionStatsJsonConverter());
            _jsonOptions.Converters.Add(new AddChildDomainJsonConverter());
            _jsonOptions.Converters.Add(new AddContactToListJsonConverter());
            _jsonOptions.Converters.Add(new BlockDomainJsonConverter());
            _jsonOptions.Converters.Add(new ComponentItemsJsonConverter());
            _jsonOptions.Converters.Add(new ContactErrorModelJsonConverter());
            _jsonOptions.Converters.Add(new CreateAttributeJsonConverter());
            _jsonOptions.Converters.Add(new CreateAttributeEnumerationInnerJsonConverter());
            _jsonOptions.Converters.Add(new CreateChildJsonConverter());
            _jsonOptions.Converters.Add(new CreateContactJsonConverter());
            _jsonOptions.Converters.Add(new CreateDoiContactJsonConverter());
            _jsonOptions.Converters.Add(new CreateEmailCampaignJsonConverter());
            _jsonOptions.Converters.Add(new CreateEmailCampaignRecipientsJsonConverter());
            _jsonOptions.Converters.Add(new CreateEmailCampaignSenderJsonConverter());
            _jsonOptions.Converters.Add(new CreateListJsonConverter());
            _jsonOptions.Converters.Add(new CreateModelJsonConverter());
            _jsonOptions.Converters.Add(new CreateSenderJsonConverter());
            _jsonOptions.Converters.Add(new CreateSenderIpsInnerJsonConverter());
            _jsonOptions.Converters.Add(new CreateSenderModelJsonConverter());
            _jsonOptions.Converters.Add(new CreateSmsCampaignJsonConverter());
            _jsonOptions.Converters.Add(new CreateSmsCampaignRecipientsJsonConverter());
            _jsonOptions.Converters.Add(new CreateSmtpEmailJsonConverter());
            _jsonOptions.Converters.Add(new CreateSmtpTemplateJsonConverter());
            _jsonOptions.Converters.Add(new CreateSmtpTemplateSenderJsonConverter());
            _jsonOptions.Converters.Add(new CreateUpdateContactModelJsonConverter());
            _jsonOptions.Converters.Add(new CreateUpdateFolderJsonConverter());
            _jsonOptions.Converters.Add(new CreateWebhookJsonConverter());
            _jsonOptions.Converters.Add(new CreatedProcessIdJsonConverter());
            _jsonOptions.Converters.Add(new DeleteHardbouncesJsonConverter());
            _jsonOptions.Converters.Add(new EmailExportRecipientsJsonConverter());
            _jsonOptions.Converters.Add(new ErrorModelJsonConverter());
            _jsonOptions.Converters.Add(new GetAccountJsonConverter());
            _jsonOptions.Converters.Add(new GetAccountAllOfMarketingAutomationJsonConverter());
            _jsonOptions.Converters.Add(new GetAccountAllOfPlanJsonConverter());
            _jsonOptions.Converters.Add(new GetAccountAllOfRelayJsonConverter());
            _jsonOptions.Converters.Add(new GetAccountAllOfRelayDataJsonConverter());
            _jsonOptions.Converters.Add(new GetAggregatedReportJsonConverter());
            _jsonOptions.Converters.Add(new GetAttributesJsonConverter());
            _jsonOptions.Converters.Add(new GetAttributesAttributesInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetAttributesAttributesInnerEnumerationInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetBlockedDomainsJsonConverter());
            _jsonOptions.Converters.Add(new GetCampaignOverviewJsonConverter());
            _jsonOptions.Converters.Add(new GetCampaignRecipientsJsonConverter());
            _jsonOptions.Converters.Add(new GetCampaignStatsJsonConverter());
            _jsonOptions.Converters.Add(new GetChildDomainJsonConverter());
            _jsonOptions.Converters.Add(new GetClientJsonConverter());
            _jsonOptions.Converters.Add(new GetContactCampaignStatsJsonConverter());
            _jsonOptions.Converters.Add(new GetContactCampaignStatsClickedInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetContactCampaignStatsOpenedInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetContactCampaignStatsTransacAttributesInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetContactCampaignStatsUnsubscriptionsJsonConverter());
            _jsonOptions.Converters.Add(new GetContactDetailsJsonConverter());
            _jsonOptions.Converters.Add(new GetContactsJsonConverter());
            _jsonOptions.Converters.Add(new GetDeviceBrowserStatsJsonConverter());
            _jsonOptions.Converters.Add(new GetEmailCampaignJsonConverter());
            _jsonOptions.Converters.Add(new GetEmailCampaignsJsonConverter());
            _jsonOptions.Converters.Add(new GetEmailCampaignsCampaignsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetEmailEventReportJsonConverter());
            _jsonOptions.Converters.Add(new GetEmailEventReportEventsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedCampaignOverviewJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedCampaignOverviewAllOfSenderJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedCampaignStatsJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedClientJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedClientAllOfAddressJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsClickedJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsLinksJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsMessagesSentJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsOpenedJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsUnsubscriptionsJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsUnsubscriptionsAdminUnsubscriptionJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedContactDetailsAllOfStatisticsUnsubscriptionsUserUnsubscriptionJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedListJsonConverter());
            _jsonOptions.Converters.Add(new GetExtendedListAllOfCampaignStatsJsonConverter());
            _jsonOptions.Converters.Add(new GetFolderJsonConverter());
            _jsonOptions.Converters.Add(new GetFolderListsJsonConverter());
            _jsonOptions.Converters.Add(new GetFoldersJsonConverter());
            _jsonOptions.Converters.Add(new GetIpJsonConverter());
            _jsonOptions.Converters.Add(new GetIpFromSenderJsonConverter());
            _jsonOptions.Converters.Add(new GetIpsJsonConverter());
            _jsonOptions.Converters.Add(new GetIpsFromSenderJsonConverter());
            _jsonOptions.Converters.Add(new GetListJsonConverter());
            _jsonOptions.Converters.Add(new GetListsJsonConverter());
            _jsonOptions.Converters.Add(new GetListsListsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetProcessJsonConverter());
            _jsonOptions.Converters.Add(new GetProcessesJsonConverter());
            _jsonOptions.Converters.Add(new GetReportsJsonConverter());
            _jsonOptions.Converters.Add(new GetReportsReportsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetSegmentsJsonConverter());
            _jsonOptions.Converters.Add(new GetSegmentsSegmentsJsonConverter());
            _jsonOptions.Converters.Add(new GetSendersListJsonConverter());
            _jsonOptions.Converters.Add(new GetSendersListSendersInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetSendersListSendersInnerIpsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetSharedTemplateUrlJsonConverter());
            _jsonOptions.Converters.Add(new GetSmsCampaignJsonConverter());
            _jsonOptions.Converters.Add(new GetSmsCampaignOverviewJsonConverter());
            _jsonOptions.Converters.Add(new GetSmsCampaignStatsJsonConverter());
            _jsonOptions.Converters.Add(new GetSmsCampaignsJsonConverter());
            _jsonOptions.Converters.Add(new GetSmsCampaignsCampaignsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetSmsEventReportJsonConverter());
            _jsonOptions.Converters.Add(new GetSmsEventReportEventsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetSmtpTemplateOverviewJsonConverter());
            _jsonOptions.Converters.Add(new GetSmtpTemplateOverviewSenderJsonConverter());
            _jsonOptions.Converters.Add(new GetSmtpTemplatesJsonConverter());
            _jsonOptions.Converters.Add(new GetSsoTokenJsonConverter());
            _jsonOptions.Converters.Add(new GetStatsByDeviceJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacAggregatedSmsReportJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacBlockedContactsJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacBlockedContactsContactsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacBlockedContactsContactsInnerReasonJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacEmailContentJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacEmailContentEventsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacEmailsListJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacEmailsListTransactionalEmailsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacSmsReportJsonConverter());
            _jsonOptions.Converters.Add(new GetTransacSmsReportReportsInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetWATemplatesJsonConverter());
            _jsonOptions.Converters.Add(new GetWATemplatesTemplatesInnerJsonConverter());
            _jsonOptions.Converters.Add(new GetWebhookJsonConverter());
            _jsonOptions.Converters.Add(new GetWebhooksJsonConverter());
            _jsonOptions.Converters.Add(new GetWhatsappCampaignOverviewJsonConverter());
            _jsonOptions.Converters.Add(new GetWhatsappCampaignsJsonConverter());
            _jsonOptions.Converters.Add(new GetWhatsappCampaignsCampaignsInnerJsonConverter());
            _jsonOptions.Converters.Add(new PostContactInfoJsonConverter());
            _jsonOptions.Converters.Add(new PostContactInfoContactsJsonConverter());
            _jsonOptions.Converters.Add(new PostSendFailedJsonConverter());
            _jsonOptions.Converters.Add(new PostSendSmsTestFailedJsonConverter());
            _jsonOptions.Converters.Add(new RemoveContactFromListJsonConverter());
            _jsonOptions.Converters.Add(new RemoveCreditsJsonConverter());
            _jsonOptions.Converters.Add(new RequestContactExportJsonConverter());
            _jsonOptions.Converters.Add(new RequestContactExportCustomContactFilterJsonConverter());
            _jsonOptions.Converters.Add(new RequestContactImportJsonConverter());
            _jsonOptions.Converters.Add(new RequestContactImportJsonBodyInnerJsonConverter());
            _jsonOptions.Converters.Add(new RequestContactImportNewListJsonConverter());
            _jsonOptions.Converters.Add(new RequestSmsRecipientExportJsonConverter());
            _jsonOptions.Converters.Add(new SendEmailJsonConverter());
            _jsonOptions.Converters.Add(new SendEmailAttachmentInnerJsonConverter());
            _jsonOptions.Converters.Add(new SendReportJsonConverter());
            _jsonOptions.Converters.Add(new SendReportEmailJsonConverter());
            _jsonOptions.Converters.Add(new SendSmsJsonConverter());
            _jsonOptions.Converters.Add(new SendSmtpEmailJsonConverter());
            _jsonOptions.Converters.Add(new SendSmtpEmailAttachmentInnerJsonConverter());
            _jsonOptions.Converters.Add(new SendSmtpEmailBccInnerJsonConverter());
            _jsonOptions.Converters.Add(new SendSmtpEmailCcInnerJsonConverter());
            _jsonOptions.Converters.Add(new SendSmtpEmailReplyToJsonConverter());
            _jsonOptions.Converters.Add(new SendSmtpEmailSenderJsonConverter());
            _jsonOptions.Converters.Add(new SendSmtpEmailToInnerJsonConverter());
            _jsonOptions.Converters.Add(new SendTemplateEmailJsonConverter());
            _jsonOptions.Converters.Add(new SendTestEmailJsonConverter());
            _jsonOptions.Converters.Add(new SendTestSmsJsonConverter());
            _jsonOptions.Converters.Add(new SendTransacSmsJsonConverter());
            _jsonOptions.Converters.Add(new UpdateAttributeJsonConverter());
            _jsonOptions.Converters.Add(new UpdateAttributeEnumerationInnerJsonConverter());
            _jsonOptions.Converters.Add(new UpdateCampaignStatusJsonConverter());
            _jsonOptions.Converters.Add(new UpdateChildJsonConverter());
            _jsonOptions.Converters.Add(new UpdateContactJsonConverter());
            _jsonOptions.Converters.Add(new UpdateEmailCampaignJsonConverter());
            _jsonOptions.Converters.Add(new UpdateEmailCampaignRecipientsJsonConverter());
            _jsonOptions.Converters.Add(new UpdateEmailCampaignSenderJsonConverter());
            _jsonOptions.Converters.Add(new UpdateListJsonConverter());
            _jsonOptions.Converters.Add(new UpdateSenderJsonConverter());
            _jsonOptions.Converters.Add(new UpdateSmsCampaignJsonConverter());
            _jsonOptions.Converters.Add(new UpdateSmtpTemplateJsonConverter());
            _jsonOptions.Converters.Add(new UpdateSmtpTemplateSenderJsonConverter());
            _jsonOptions.Converters.Add(new UpdateWebhookJsonConverter());
            _jsonOptions.Converters.Add(new UploadImageToGalleryJsonConverter());
            _jsonOptions.Converters.Add(new VariablesItemsJsonConverter());
            _jsonOptions.Converters.Add(new WhatsappCampStatsJsonConverter());
            _jsonOptions.Converters.Add(new WhatsappCampTemplateJsonConverter());
            JsonSerializerOptionsProvider jsonSerializerOptionsProvider = new(_jsonOptions);
            _services.AddSingleton(jsonSerializerOptionsProvider);
            _services.AddSingleton<IApiFactory, ApiFactory>();
            _services.AddSingleton<AccountApiEvents>();
            _services.AddTransient<IAccountApi, AccountApi>();
            _services.AddSingleton<AttributesApiEvents>();
            _services.AddTransient<IAttributesApi, AttributesApi>();
            _services.AddSingleton<ContactsApiEvents>();
            _services.AddTransient<IContactsApi, ContactsApi>();
            _services.AddSingleton<EmailCampaignsApiEvents>();
            _services.AddTransient<IEmailCampaignsApi, EmailCampaignsApi>();
            _services.AddSingleton<FoldersApiEvents>();
            _services.AddTransient<IFoldersApi, FoldersApi>();
            _services.AddSingleton<ListsApiEvents>();
            _services.AddTransient<IListsApi, ListsApi>();
            _services.AddSingleton<ProcessApiEvents>();
            _services.AddTransient<IProcessApi, ProcessApi>();
            _services.AddSingleton<SMSCampaignsApiEvents>();
            _services.AddTransient<ISMSCampaignsApi, SMSCampaignsApi>();
            _services.AddSingleton<SMTPApiEvents>();
            _services.AddTransient<ISMTPApi, SMTPApi>();
            _services.AddSingleton<SendersApiEvents>();
            _services.AddTransient<ISendersApi, SendersApi>();
            _services.AddSingleton<TransactionalSMSApiEvents>();
            _services.AddTransient<ITransactionalSMSApi, TransactionalSMSApi>();
            _services.AddSingleton<WebhooksApiEvents>();
            _services.AddTransient<IWebhooksApi, WebhooksApi>();
            _services.AddSingleton<WhatsAppCampaignsApiEvents>();
            _services.AddTransient<IWhatsAppCampaignsApi, WhatsAppCampaignsApi>();
        }

        /// <summary>
        /// Configures the HttpClients.
        /// </summary>
        /// <param name="client"></param>
        /// <param name="builder"></param>
        /// <returns></returns>
        public HostConfiguration AddApiHttpClients
        (
            Action<HttpClient>? client = null, Action<IHttpClientBuilder>? builder = null)
        {
            if (client == null)
                client = c => c.BaseAddress = new Uri(ClientUtils.BASE_ADDRESS);

            List<IHttpClientBuilder> builders = new List<IHttpClientBuilder>();

            builders.Add(_services.AddHttpClient<IAccountApi, AccountApi>(client));
            builders.Add(_services.AddHttpClient<IAttributesApi, AttributesApi>(client));
            builders.Add(_services.AddHttpClient<IContactsApi, ContactsApi>(client));
            builders.Add(_services.AddHttpClient<IEmailCampaignsApi, EmailCampaignsApi>(client));
            builders.Add(_services.AddHttpClient<IFoldersApi, FoldersApi>(client));
            builders.Add(_services.AddHttpClient<IListsApi, ListsApi>(client));
            builders.Add(_services.AddHttpClient<IProcessApi, ProcessApi>(client));
            builders.Add(_services.AddHttpClient<ISMSCampaignsApi, SMSCampaignsApi>(client));
            builders.Add(_services.AddHttpClient<ISMTPApi, SMTPApi>(client));
            builders.Add(_services.AddHttpClient<ISendersApi, SendersApi>(client));
            builders.Add(_services.AddHttpClient<ITransactionalSMSApi, TransactionalSMSApi>(client));
            builders.Add(_services.AddHttpClient<IWebhooksApi, WebhooksApi>(client));
            builders.Add(_services.AddHttpClient<IWhatsAppCampaignsApi, WhatsAppCampaignsApi>(client));
            
            if (builder != null)
                foreach (IHttpClientBuilder instance in builders)
                    builder(instance);

            HttpClientsAdded = true;

            return this;
        }

        /// <summary>
        /// Configures the JsonSerializerSettings
        /// </summary>
        /// <param name="options"></param>
        /// <returns></returns>
        public HostConfiguration ConfigureJsonOptions(Action<JsonSerializerOptions> options)
        {
            options(_jsonOptions);

            return this;
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="token"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(TTokenBase token) where TTokenBase : TokenBase
        {
            return AddTokens(new TTokenBase[]{ token });
        }

        /// <summary>
        /// Adds tokens to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <param name="tokens"></param>
        /// <returns></returns>
        public HostConfiguration AddTokens<TTokenBase>(IEnumerable<TTokenBase> tokens) where TTokenBase : TokenBase
        {
            TokenContainer<TTokenBase> container = new TokenContainer<TTokenBase>(tokens);
            _services.AddSingleton(services => container);

            return this;
        }

        /// <summary>
        /// Adds a token provider to your IServiceCollection
        /// </summary>
        /// <typeparam name="TTokenProvider"></typeparam>
        /// <typeparam name="TTokenBase"></typeparam>
        /// <returns></returns>
        public HostConfiguration UseProvider<TTokenProvider, TTokenBase>() 
            where TTokenProvider : TokenProvider<TTokenBase>
            where TTokenBase : TokenBase
        {
            _services.AddSingleton<TTokenProvider>();
            _services.AddSingleton<TokenProvider<TTokenBase>>(services => services.GetRequiredService<TTokenProvider>());

            return this;
        }
    }
}
